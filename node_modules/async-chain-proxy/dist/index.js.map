{"version":3,"sources":["../src/index.js"],"names":["RESULT_FUNCTION_NAME","ChainObject","target","options","defaults","debug","Object","assign","actions","name","args","push","result","idx","action","console","log","apply","makeHandler","get","chainObj","endFuncName","end","arguments","then","onChainFinished","catch","e","resultFuncName","addAction","Error","set","value","createChainObject","defaultParams","chainObject","Proxy","module","exports"],"mappings":"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","file":"index.js","sourcesContent":["\nimport 'babel-polyfill';\nconst RESULT_FUNCTION_NAME = '___RESULT_FUNCTION'\n\nclass ChainObject {\n  constructor (target, options) {\n    const defaults = {\n      debug: false\n    }\n    this.target = target\n    this.options = Object.assign(defaults, options)\n    this.actions = []\n  }\n\n  addAction (name, args) {\n    this.actions.push({name, args})\n  }\n\n  async end () {\n    let result = null\n    const actions = Object.assign({}, this.actions)\n    this.actions = []\n    try {\n      for (let idx in actions) {\n        const action = actions[idx]\n        if (this.options.debug) {\n          console.log(`[async-chain-proxy] execute '${action.name}'`)\n        }\n        if (RESULT_FUNCTION_NAME === action.name) {\n          result = await action.args[0].apply(null, [result])\n        } else {\n          result = await this.target[action.name].apply(this.target, action.args)\n        }\n      }\n    } catch (e) {\n      if (this.options.debug) {\n        console.log(e)\n      }\n      throw e\n    }\n    return result\n  }\n}\n\nfunction makeHandler (target, options) {\n  return {\n    get: function (chainObj, name) {\n      if (name === options.endFuncName) {\n        return function () {\n          return chainObj.end(chainObj, arguments).then(result => {\n            if (options.onChainFinished) {\n              options.onChainFinished(target)\n            }\n            return result\n          }).catch((e) => {\n            if (options.debug) {\n              console.log(e)\n            }\n            throw e\n          })\n        }\n      } else if (name === options.resultFuncName) {\n        return function () {\n          chainObj.addAction(RESULT_FUNCTION_NAME, arguments)\n          return this\n        }\n      } else if (name === 'target') {\n        return target\n      } else if (typeof(target[name]) === 'function') {\n        return function () {\n          chainObj.addAction(name, arguments)\n          return this\n        }\n      } else if (name in target) {\n        return target[name]\n      } else {\n        throw new Error(`'${name}' is not defined on a target object.`)\n      }\n    },\n    set: function (chainObj, name, value) {\n      throw new Error('You cannot set a value to Proxy object.')\n    }\n  }\n}\n\nfunction createChainObject (target, options = {}) {\n  const defaultParams = {\n    debug: false,\n    resultFuncName: 'result',\n    endFuncName: 'end',\n    onChainFinished: null\n  }\n  options = Object.assign(defaultParams, options)\n  let chainObject = new ChainObject(target, options)\n  return new Proxy(\n    chainObject,\n    makeHandler (target, options)\n  )\n}\n\nmodule.exports = createChainObject\n\n"]}