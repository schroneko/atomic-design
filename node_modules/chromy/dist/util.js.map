{"version":3,"sources":["../src/util.js"],"names":["chromeLauncher","require","path","DEFAULT_ARGS","escapeHtml","string","replace","match","escapeSingleQuote","escapeNewLine","createChromeLauncher","startingUrl","options","flags","concat","chromeInstance","process","platform","push","visible","chromeFlags","Array","isArray","forEach","f","indexOf","Error","additionalChromeFlags","console","warn","params","port","logLevel","enableExtensions","handleSIGINT","chromePath","userDataDir","launch","completeUrl","url","reg","RegExp","regAbbr","test","join","cwd","exports"],"mappings":"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","file":"util.js","sourcesContent":["'use strict'\n\nconst chromeLauncher = require('chrome-launcher')\nconst path = require('path')\n\n// Borrow from here:\n// https://github.com/GoogleChrome/puppeteer/blob/master/lib/Launcher.js#L30\nconst DEFAULT_ARGS = [\n  '--disable-background-networking',\n  '--disable-background-timer-throttling',\n  '--disable-client-side-phishing-detection',\n  '--disable-default-apps',\n  '--disable-hang-monitor',\n  '--disable-popup-blocking',\n  '--disable-prompt-on-repost',\n  '--disable-sync',\n  '--enable-automation',\n  '--enable-devtools-experiments',\n  '--metrics-recording-only',\n  '--no-first-run',\n  '--password-store=basic',\n  '--safebrowsing-disable-auto-update',\n  '--use-mock-keychain',\n]\n\n// borrow from: http://qiita.com/saekis/items/c2b41cd8940923863791\nfunction escapeHtml (string) {\n  if (typeof string !== 'string') {\n    return string\n  }\n  return string.replace(/[&'`\"<>]/g, function (match) {\n    return {\n      '&': '&amp;',\n      '\\'': '&#x27;',\n      '`': '&#x60;',\n      '\"': '&quot;',\n      '<': '&lt;',\n      '>': '&gt;',\n    }[match]\n  })\n}\n\nfunction escapeSingleQuote (string) {\n  if (typeof string !== 'string') {\n    return string\n  }\n  return string.replace(/'/g, '\\\\\\'')\n}\n\nfunction escapeNewLine (string) {\n  return string.replace(/\\r?\\n/g, '\\\\n')\n}\n\nasync function createChromeLauncher (startingUrl, options) {\n  const flags = [].concat(DEFAULT_ARGS)\n  let chromeInstance\n\n  // Lighthouse adds '--disable-setuid-sandbox' flag automatically.\n  // The flag causes an error on linux when staring headless chrome.\n  // '--no-sandbox' suppresses an error caused by '--disable-setuid-sandbox'.\n  if (process.platform === 'linux') {\n    flags.push('--no-sandbox')\n  }\n  if (!options.visible) {\n    flags.push('--headless')\n    flags.push('--hide-scrollbars')\n    flags.push('--mute-audio')\n  }\n  if (options.chromeFlags && Array.isArray(options.chromeFlags)) {\n    options.chromeFlags.forEach(f => {\n      if (f.indexOf('--') === -1) {\n        throw new Error('An item of chromFlags option must have \"--\" at start of itself. the value: ' + f)\n      }\n      flags.push(f)\n    })\n  }\n  if (options.additionalChromeFlags && Array.isArray(options.additionalChromeFlags)) {\n    console.warn('[chromy] additionalChromeFlags is deprecated. Use chromeFlags instead of this.')\n    options.additionalChromeFlags.forEach(f => {\n      if (f.indexOf('--') === -1) {\n        throw new Error('An item of chromFlags option must have \"--\" at start of itself. the value: ' + f)\n      }\n      flags.push(f)\n    })\n  }\n  const params = {\n    port: options.port,\n    chromeFlags: flags,\n    startingUrl: startingUrl,\n    logLevel: 'error',\n    enableExtensions: options.enableExtensions,\n    handleSIGINT: false,\n  }\n  if (options.chromePath) {\n    params.chromePath = options.chromePath\n  }\n  if (options.userDataDir) {\n    params.userDataDir = options.userDataDir\n  }\n\n  chromeInstance = await chromeLauncher.launch(params)\n\n  return chromeInstance\n}\n\nfunction completeUrl (url) {\n  const reg = new RegExp('^[a-zA-Z0-9]+:', 'i')\n  const regAbbr = new RegExp('^//', 'i')\n  if (reg.test(url)) {\n    return url\n  } else if (regAbbr.test(url)) {\n    return 'http:' + url\n  } else {\n    return 'file://' + path.join(process.cwd(), url)\n  }\n}\n\nexports.escapeHtml = escapeHtml\nexports.escapeSingleQuote = escapeSingleQuote\nexports.escapeNewLine = escapeNewLine\nexports.createChromeLauncher = createChromeLauncher\nexports.completeUrl = completeUrl\n\n"]}